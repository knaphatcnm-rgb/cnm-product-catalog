<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CNM Interior ‚Äì Product Catalog</title>

  <style>
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:#f4f4f4;
      color:#333;
    }
    header{
      background:#111;
      color:#fff;
      padding:16px;
      text-align:center;
      font-size:18px;
    }
    .container{ padding:12px; }

    .search-box{
      display:flex;
      gap:8px;
      margin-bottom:12px;
    }
    .search-box input{
      flex:1;
      padding:12px;
      font-size:15px;
      border-radius:10px;
      border:1px solid #ccc;
    }
    .search-box button{
      padding:12px 16px;
      font-size:15px;
      border-radius:10px;
      border:none;
      background:#0a7cff;
      color:#fff;
    }

    .card{
      background:#fff;
      border-radius:14px;
      margin-bottom:16px;
      overflow:hidden;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
    }
    .card img{
      width:100%;
      height:220px;
      object-fit:cover;
      background:#eee;
    }
    .content{ padding:14px; }
    .code{ font-size:12px;color:#888; }
    .name{ font-size:16px;font-weight:600;margin:6px 0; }
    .size{ font-size:14px;color:#555;margin-bottom:8px; }
    .price{ font-size:18px;font-weight:700;color:#0a7cff;margin-bottom:10px; }
    .btn{
      display:block;
      text-align:center;
      padding:10px;
      background:#0a7cff;
      color:#fff;
      border-radius:10px;
      text-decoration:none;
      font-size:14px;
    }
  </style>
</head>

<body>

<header>CNM Interior Product Catalog</header>

<div class="container">
  <div class="search-box">
    <input id="searchInput" type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ / ‡∏£‡∏´‡∏±‡∏™ / ‡πÅ‡∏ó‡πá‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
    <button id="searchBtn">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
  </div>

  <div id="products"></div>
</div>

<script>
/* ================= CONFIG ================= */
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vSDhv-ti8VG4RV7TjgJqVz4kMRuWcY_nbqhcvW6WdjPUJwa4T6qFNUHBq47RjN5wDGRtKdI23BpdKpl/pub?output=csv";

/* ================= STATE ================= */
let PRODUCTS = [];

/* ================= CSV PARSER ================= */
function parseCSV(text){
  const rows=[];
  let row=[], val="", q=false;
  for(let i=0;i<text.length;i++){
    const c=text[i], n=text[i+1];
    if(c=='"'&&n=='"'){ val+='"'; i++; }
    else if(c=='"'){ q=!q; }
    else if(c==','&&!q){ row.push(val); val=""; }
    else if((c=='\n'||c=='\r')&&!q){
      if(val||row.length) row.push(val);
      if(row.length) rows.push(row);
      row=[]; val="";
    } else val+=c;
  }
  if(val||row.length){ row.push(val); rows.push(row); }
  return rows;
}

/* ================= LOAD DATA ================= */
fetch(CSV_URL)
  .then(r=>r.text())
  .then(text=>{
    const rows=parseCSV(text);
    const headers=rows.shift();

    rows.forEach(row=>{
      const p={};
      headers.forEach((h,i)=>p[h]=(row[i]||"").trim());
      PRODUCTS.push(p);
    });

    renderProducts(PRODUCTS);
  });

/* ================= RENDER ================= */
function renderProducts(list){
  const box=document.getElementById("products");
  box.innerHTML="";

  if(list.length===0){
    box.innerHTML="<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>";
    return;
  }

  list.forEach(p=>{
    let img=p.image_url||"";
    if(!img && p.Drive_raw){
      const m=p.Drive_raw.match(/\/d\/([^/]+)/);
      if(m) img=`https://lh3.googleusercontent.com/d/${m[1]}=w1200`;
    }

    const price=Number((p["‡∏£‡∏≤‡∏Ñ‡∏≤"]||"").replace(/,/g,""));
    const priceText=!isNaN(price)?price.toLocaleString()+" ‡∏ö‡∏≤‡∏ó":"";

    box.insertAdjacentHTML("beforeend",`
      <div class="card">
        <img src="${img}" onerror="this.style.display='none'">
        <div class="content">
          <div class="code">${p.Code||""}</div>
          <div class="name">${p.NAME||""}</div>
          <div class="size">${p["‡∏Ç‡∏ô‡∏≤‡∏î"]||""}</div>
          <div class="price">${priceText}</div>
          <a class="btn" href="${p.LINK||"#"}" target="_blank">
            ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
          </a>
        </div>
      </div>
    `);
  });
}

/* ================= SEARCH ================= */
document.getElementById("searchBtn").addEventListener("click", doSearch);
document.getElementById("searchInput").addEventListener("keypress", e=>{
  if(e.key==="Enter") doSearch();
});

function doSearch(){
  const kw = document
    .getElementById("searchInput")
    .value
    .trim()
    .toLowerCase();

  // üëâ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏∞‡πÑ‡∏£ = ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  if(kw === ""){
    renderProducts(PRODUCTS);
    return;
  }

  // üëâ ‡∏ñ‡πâ‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏ï‡πà‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô
  if(kw.length < 2){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£");
    return;
  }

  const result = PRODUCTS.filter(p=>{
    return (
      (p.Code || "").toLowerCase().includes(kw) ||
      (p.NAME || "").toLowerCase().includes(kw) ||
      (p.product_tags || "").toLowerCase().includes(kw)
    );
  });

  renderProducts(result);
}


  const result=PRODUCTS.filter(p=>{
    return (
      (p.Code||"").toLowerCase().includes(kw) ||
      (p.NAME||"").toLowerCase().includes(kw) ||
      (p.product_tags||"").toLowerCase().includes(kw)
    );
  });

  renderProducts(result);
}
</script>

</body>
</html>
