<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CNM Interior – Product Catalog</title>

  <style>
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:#f4f4f4;
      color:#333;
    }
    header{
      background:#111;
      color:#fff;
      padding:16px;
      text-align:center;
      font-size:18px;
    }
    .container{ padding:12px; }
    .card{
      background:#fff;
      border-radius:14px;
      margin-bottom:16px;
      overflow:hidden;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
    }
    .card img{
      width:100%;
      height:220px;
      object-fit:cover;
      background:#eee;
    }
    .content{ padding:14px; }
    .code{ font-size:12px;color:#888; }
    .name{ font-size:16px;font-weight:600;margin:6px 0; }
    .size{ font-size:14px;color:#555;margin-bottom:8px; }
    .price{ font-size:18px;font-weight:700;color:#0a7cff;margin-bottom:10px; }
    .btn{
      display:block;
      text-align:center;
      padding:10px;
      background:#0a7cff;
      color:#fff;
      border-radius:10px;
      text-decoration:none;
      font-size:14px;
    }
  </style>
</head>

<body>

<header>CNM Interior Product Catalog</header>
<div class="container" id="products"></div>

<script>
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vSDhv-ti8VG4RV7TjgJqVz4kMRuWcY_nbqhcvW6WdjPUJwa4T6qFNUHBq47RjN5wDGRtKdI23BpdKpl/pub?output=csv";

/* CSV Parser */
function parseCSV(text){
  const rows=[], r=[], v="";
  let row=[], val="", q=false;
  for(let i=0;i<text.length;i++){
    const c=text[i], n=text[i+1];
    if(c=='"'&&n=='"'){val+='"';i++}
    else if(c=='"')q=!q;
    else if(c==','&&!q){row.push(val);val=""}
    else if((c=='\n'||c=='\r')&&!q){
      if(val||row.length)row.push(val);
      if(row.length)rows.push(row);
      row=[];val="";
    } else val+=c;
  }
  if(val||row.length){row.push(val);rows.push(row)}
  return rows;
}

fetch(CSV_URL)
  .then(r=>r.text())
  .then(text=>{
    const rows=parseCSV(text);
    const headers=rows.shift();
    const box=document.getElementById("products");

    rows.forEach(row=>{
      const p={};
      headers.forEach((h,i)=>p[h]=(row[i]||"").trim());

      let img=p.image_url||"";
      if(!img && p.Drive_raw){
        const m=p.Drive_raw.match(/\/d\/([^/]+)/);
        if(m) img=`https://lh3.googleusercontent.com/d/${m[1]}=w1200`;
      }

      const price=Number((p["ราคา"]||"").replace(/,/g,""));
      const priceText=!isNaN(price)?price.toLocaleString()+" บาท":"";

      box.insertAdjacentHTML("beforeend",`
        <div class="card">
          <img src="${img}" onerror="this.style.display='none'">
          <div class="content">
            <div class="code">${p.Code||""}</div>
            <div class="name">${p.NAME||""}</div>
            <div class="size">${p["ขนาด"]||""}</div>
            <div class="price">${priceText}</div>
            <a class="btn" href="${p.LINK||"#"}" target="_blank">ดูรายละเอียดสินค้า</a>
          </div>
        </div>
      `);
    });
  });
</script>

</body>
</html>
