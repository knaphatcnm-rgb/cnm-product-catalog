<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>CNM Project Catalog</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===== BASE ===== */
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #f4f6f8;
}

/* ===== HEADER ===== */
header {
  background: #0a3d62;
  color: #fff;
  padding: 14px;
}

header h2 {
  margin: 0;
  font-size: 18px;
}

/* ===== GRID ===== */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 12px;
  padding: 12px;
}

/* ===== CARD ===== */
.card {
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,.15);
  cursor: pointer;
  overflow: hidden;
  transition: transform .15s ease, box-shadow .15s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0,0,0,.2);
}

.card img {
  width: 100%;
  height: 120px;
  object-fit: cover;
  background: #eee;
}

.card .info {
  padding: 10px;
}

.card .code {
  font-size: 12px;
  color: #777;
}

.card .name {
  font-size: 14px;
  font-weight: 600;
  margin-top: 4px;
}
</style>
</head>

<body>

<header>
  <h2>รายการโครงการ</h2>
</header>

<div class="grid" id="projectGrid">
  <!-- Project cards will be injected here -->
</div>

<script>
/* ==========================
   CONFIG
========================== */
const API_URL = "https://script.google.com/macros/s/AKfycbweCz70hdfMcDwfhlPN8rqfTDFW_DeCdsnmVEbGAKbudVhvx38R7bJMe5L61scwds4Y/exec";

/* ==========================
   INIT
========================== */
loadProjects();

/* ==========================
   FUNCTIONS
========================== */
async function loadProjects() {
  try {
    const res = await fetch(`${API_URL}?action=projects`);
    const projects = await res.json();

    const grid = document.getElementById("projectGrid");
    grid.innerHTML = "";

    if (!Array.isArray(projects) || projects.length === 0) {
      grid.innerHTML = "<p>ไม่พบโครงการ</p>";
      return;
    }

    projects.forEach(p => {
      const card = document.createElement("div");
      card.className = "card";

      card.onclick = () => {
        window.location.href =
          `project.html?project_id=${p.PROJECT_ID}`;
      };

      card.innerHTML = `
        <img src="${p.COVER_IMAGE || 'https://via.placeholder.com/300x200?text=No+Image'}">
        <div class="info">
          <div class="code">${p.PROJECT_CODE || ''}</div>
          <div class="name">${p.PROJECT_NAME || ''}</div>
        </div>
      `;

      grid.appendChild(card);
    });

  } catch (err) {
    console.error(err);
    document.getElementById("projectGrid").innerHTML =
      "<p>เกิดข้อผิดพลาดในการโหลดข้อมูล</p>";
  }
}
</script>

</body>
</html>
