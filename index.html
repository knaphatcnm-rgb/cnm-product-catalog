<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>CNM Access</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>

<body>
‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...

<script>
const LIFF_ID = "2008736700-X7cUjaUv";
const API_URL =
  "https://script.google.com/macros/s/AKfycbz9baTaW8kfgG-bQ-ZcB1RR0BwAPqgk0fTxmW536KUSpLOzrD9U_ZctQhw2-lEFKA/exec";

async function start() {
  try {
    await liff.init({ liffId: LIFF_ID });

    // üîí ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE App
    if (!liff.isInClient()) {
      document.body.innerText =
        "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE Official Account ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô";
      return;
    }

    if (!liff.isLoggedIn()) {
      liff.login();
      return;
    }

    // ‚úÖ ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡πÑ‡∏õ
    const profile = await liff.getProfile();
    const userId = profile.userId;

    if (!userId) {
      document.body.innerText = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á LINE User ID ‡πÑ‡∏î‡πâ";
      return;
    }

    const res = await fetch(API_URL + "?userId=" + userId, {
      cache: "no-store"
    });

    const result = await res.json();

    switch (result.status) {
      case "approved":
        location.replace("catalog.html");
        break;

      case "pending":
        document.body.innerText =
          "‚è≥ ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•";
        break;

      case "reject":
        location.replace("register.html");
        break;

      default:
        location.replace("register.html");
    }

  } catch (err) {
    document.body.innerText =
      "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
  }
}

start();
</script>
</body>
</html>
