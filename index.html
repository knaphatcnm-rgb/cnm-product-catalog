<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CNM Interior – Product Catalog</title>

  <style>
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:#f4f4f4;
      color:#333;
    }
    header{
      background:#111;
      color:#fff;
      padding:16px;
      text-align:center;
      font-size:18px;
      letter-spacing:0.5px;
    }
    .container{
      padding:12px;
    }
    .card{
      background:#fff;
      border-radius:14px;
      margin-bottom:16px;
      overflow:hidden;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
    }
    .card img{
      width:100%;
      height:220px;
      object-fit:cover;
      background:#eee;
    }
    .content{
      padding:14px;
    }
    .code{
      font-size:12px;
      color:#888;
    }
    .name{
      font-size:16px;
      font-weight:600;
      margin:6px 0;
    }
    .size{
      font-size:14px;
      color:#555;
      margin-bottom:8px;
    }
    .price{
      font-size:18px;
      font-weight:700;
      color:#0a7cff;
      margin-bottom:10px;
    }
    .btn{
      display:block;
      text-align:center;
      padding:10px;
      background:#0a7cff;
      color:#fff;
      border-radius:10px;
      text-decoration:none;
      font-size:14px;
    }
  </style>
</head>
<body>

<header>
  CNM Interior Product Catalog
</header>

<div class="container" id="products"></div>

<script>
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vSDhv-ti8VG4RV7TjgJqVz4kMRuWcY_nbqhcvW6WdjPUJwa4T6qFNUHBq47RjN5wDGRtKdI23BpdKpl/pub?output=csv";

/* ---------- CSV PARSER ---------- */
function parseCSV(text) {
  const rows = [];
  let row = [], val = "", quote = false;

  for (let i = 0; i < text.length; i++) {
    const c = text[i], n = text[i + 1];
    if (c === '"' && n === '"') { val += '"'; i++; }
    else if (c === '"') quote = !quote;
    else if (c === "," && !quote) { row.push(val); val = ""; }
    else if ((c === "\n" || c === "\r") && !quote) {
      if (val || row.length) row.push(val);
      if (row.length) rows.push(row);
      row = []; val = "";
    } else val += c;
  }
  if (val || row.length) { row.push(val); rows.push(row); }
  return rows;
}

/* ---------- FETCH ---------- */
fetch(CSV_URL)
  .then(r => r.text())
  .then(text => {
    const rows = parseCSV(text);
    const headers = rows.shift();
    const container = document.getElementById("products");
    container.innerHTML = "";

    rows.forEach(row => {
      if (row.length < headers.length) return;

      const p = {};
      headers.forEach((h, i) => p[h] = (row[i] || "").trim());

      /* IMAGE */
      let image = p["image_url"] || "";
      if (!image && p["Drive_raw"]) {
        const m = p["Drive_raw"].match(/\/d\/([^/]+)/);
        if (m) image = `https://lh3.googleusercontent.com/d/${m[1]}=w1200`;
      }

      const price = Number((p["ราคา"] || "").replace(/,/g,""));
      const priceText = !isNaN(price) ? price.toLocaleString()+" บาท" : "";

      container.insertAdjacentHTML("beforeend", `
        <div class="card">
          <img 
            src="${image || ""}"
            loading="lazy"
            decoding="async"
            referrerpolicy="no-referrer"
            onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22220%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22%23eee%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23999%22 font-size=%2220%22>No Image</text></svg>'"
          >
          <div class="content">
            <div class="code">${p["Code"] || ""}</div>
            <div class="name">${p["NAME"] || ""}</div>
            <div class="size">${p["ขนาด"] || ""}</div>
            <div class="price">${priceText}</div>
            <a class="btn" href="${p["LINK"] || "#"}" target="_blank">
              ดูรายละเอียดสินค้า
            </a>
          </div>
        </div>
      `);
    });
  });
</script>




<!-- LIFF SDK -->
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<script>
const LIFF_ID = "2008736700-X7cUjaUv";
const SHEET_URL =
  "https://opensheet.elk.sh/1E0INtYPUHooDTuOm1KtU8UTHpcYIr9bOLODZqxuL0/Form_Responses";

async function checkAccess() {
  await liff.init({ liffId: LIFF_ID });

  if (!liff.isLoggedIn()) {
    liff.login();
    return;
  }

  const profile = await liff.getProfile();
  const myName = profile.displayName;

  const res = await fetch(SHEET_URL);
  const rows = await res.json();

  const user = rows.find(r =>
    r["LINE Display Name"] === myName
  );

  const lock = document.getElementById("lock");
  const catalog = document.getElementById("catalog");

  if (!user) {
    lock.innerHTML = `
      <h2>❌ ไม่พบข้อมูลการลงทะเบียน</h2>
      <p>กรุณาลงทะเบียนก่อนใช้งาน</p>
    `;
    return;
  }

  if (user.status !== "approved") {
    lock.innerHTML = `
      <h2>⏳ รอการอนุมัติ</h2>
      <p>สถานะปัจจุบัน: ${user.status}</p>
    `;
    return;
  }

  // ✅ ผ่านการอนุมัติ
  lock.style.display = "none";
  catalog.style.display = "block";
}

checkAccess();
</script>



</body>
</html>

















