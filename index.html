<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>CNM Access</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>

<body>
กำลังตรวจสอบสิทธิ์...

<script>
const LIFF_ID = "2008736700-X7cUjaUv";
const API_URL = "https://script.google.com/macros/s/AKfycbxl2OyJW-W_Npn5eDKwJu2JiNteQ5PFtxy1M61UAEmWAKCSS7RmNlauxwCGBGhwBtqA/exec";

async function start() {
  await liff.init({ liffId: LIFF_ID });

  if (!liff.isLoggedIn()) {
    liff.login();
    return;
  }

  const profile = await liff.getProfile();
  const userId = profile.userId;

  const res = await fetch(API_URL + "?userId=" + userId);
  const result = await res.json();

  if (result.allowed) {
    window.location.replace("catalog.html");
  } else {
    window.location.replace("register.html");
  }
}

start();
</script>
</body>
</html>

